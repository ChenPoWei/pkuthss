% Copyright (c) 2014,2016 Casper Ti. Vector
% Public domain.

\chapter{文獻探討}
%\pkuthssffaq % 中文测试文字。
	\section{比特幣（Bitcoin）}
	比特幣（Bitcoin，BTC）是一個點對點式的點子現金系統，集成了非對稱式金鑰密碼學（Asymmetric Key Cryptography）\parencite{AsymmetricKeyCryptography}、簽章密碼學（Signature cryptography）、零知識證明密碼學（Zero Knowledge Proof Cryptography）\parencite{Zero-KnowledgeProofsofIdentity}、哈希函數密碼學（Hash function cryptography）、共式算法（Consensus）諸多技術建構了一個分散式的不需要靠中心化機構加以維護的交易帳本（區塊鏈）。在接下來的章節中將逐一進行詳盡的說明每個技術在各個環節中所扮演的角色。

	\section{比特幣地址（Bitcoin Address）}
	比特幣地址為比特幣的載體，深入了解比特幣地址生成相關算法的、比特幣地址生成過程、多重簽名。可以應用在区块链的实名交易监督系统。

		\subsection{比特幣地址生成相關算法}
		在點對點的現金系統中，首先必須先生成一個地址，在比特幣的協議中有著既定的程序生成地址。運用到的技術包括亂數產生器、secp256k1\parencite{johnson2001elliptic}、SHA-256（哈希函數）\parencite{DBLP:conf/fse/KhovratovichRS12}、RIPEMD-160（哈希函數）\parencite{DBLP:conf/isw/MendelPRR06}、Base58\parencite{Base58}。接下來回詳細說明每一個函數的運做過程以及意義，最後說明比特幣交易地址生成的每一個步驟。
		
			\subsubsection{亂數產生器（Random number generator）}
			亂數在密碼學中是個相當重要的一環，在比特幣系統中更是重要，畢竟生成的亂數會變成比特幣的私鑰，私鑰是簽署資產轉移的唯一方式，在比特幣地址中的亂數產生器會產出一個256 bits長度的亂數，也就是私鑰，256 bits的長度可以表現的組態空間為$2^{256}$，換算成十進位表示為$1.1579209x10^{77}$，要在這組態空間中，以亂數產生同樣的一把私鑰是一件困難的事，但也有國際的實驗室\parencite{TheLargeBitcoinCollider}也有團隊正在努力的窮舉比特幣$2^{256}$的組態空間，如下圖\ref{LBC}所示，根據LBC公布的數據顯示，目前已經完成了$2.330109x10^{16}$個地址探索。雖然$10^{16}$的級別與$10^{77}$的級別相距甚遠，但LBC已探索空間中擊中了15個比特幣地址，團隊也將這15個地址的1.180899個比特幣轉走。

			\begin{figure}[h]
				\centering
				\includegraphics[width = .9\textwidth]{LBC.png}
				\caption{Bitcoin Full Node\parencite{TheLargeBitcoinCollider}}\label{LBC}
			\end{figure}

			如何建構一個亂數，在過往的亂數產生器往往會加入時間作為參數，但對於一個攻擊者而言，只需要去猜測在這段時間內所有的可能性即可猜出亂數。而亂數在密碼學中通常會是一個把私鑰的構建，在https協議中，服務器端與客戶端，建立一個加密連線的過程中也需要一個亂數去建立一個高安全性的加密通道，在SSH協議中也採用了亂數。
	
			在過去的歷史事件中，發現Android手機版以及平板版的亂數產生器的存在著不隨機，於2013年8月比特幣開發者Mike Hearn提及“All private keys generated on Android phones/tablets are weak and some signatures have been observed to have colliding R values” \parencite{SomeSecureRandomThoughts}，Bitcoin.org也發布了警告\parencite{AndroidSecurityVulnerability}簡要說明該事件的原因，以及表明影響到的Bitcoin Wallet 客戶端有Bitcoin Wallet、BitcoinSpinner、Mycelium Bitcoin Wallet、blockchain.info。這樣的錯誤源於Android本身支持的亂數產生器並不隨機，隨後Android解釋了亂數的問題並加以修正。在這Android手機亂數不夠亂的事件中，有自願者自發性地公佈自己的損失狀態，總金額為55.82152538個比特幣\parencite{Badsignaturesleading}，但因為比特幣屬於被動的性質，無人主動回報既不會加入統計中，所以總損失應該會超過55.82152538個比特幣。

			\subsubsection{secp256k1}
			在密碼學中有分對稱式加密與非對稱式加密，對稱式加密又分為信息流加密與信息塊加密，信息流加密著名的是由美國密碼學家Ron Rivest教授設計，包括RC2(1987年)\parencite{OnthedesignandsecurityofRC2}、RC4(1987年)\parencite{Rc4}、RC5(1994年)\parencite{TheRC5encryptionalgorithm}、RC6(1998年)\parencite{TheRC6blockcipher.v1.1August201998}；信息塊加密著名的有数据加密标准(Data Encryption Standard，DES，1975年)\parencite{Dataencryptionstandard}、三重数据加密算法（Triple Data Encryption Algorithm，Triple DES，1998年）\parencite{TrippleDataEncryptionAlgorithmModesofOperation}、高级加密标准（Advanced Encryption Standard，AES，1998年）\parencite{ThedesignofRijndael:AES-theadvancedencryptionstandard}；非對稱是加密最為著名的有RSA（Rivest–Shamir–Adleman，1977年）\parencite{Cryptographiccommunicationssystemandmethod}、椭圆曲线密码学（Elliptic curve cryptography，ECC，1985年）\parencite{Ellipticcurvecryptosystems}。
			非對稱式加密與對稱式加密最大的不同在於，對稱是加密在加密解密的過程中只需要一把鑰匙，而非對稱是加密會生成兩把鑰匙分別為私鑰與公鑰，在算法的設計上在一開始會以亂數產生一把私鑰，再經由非對稱是加密算法推導出公鑰，推導出的公鑰在非對稱式密碼學中是相當難以到推回去私鑰，如此一來確立私鑰的安全性。非對稱式密碼的使用場景有兩種，第一種是希望收到加密信息的Alice，Alice會生成私鑰存儲在自己本地端的電腦中，並將推導出的公鑰公布在網路上，這時希望聯繫Alice的Bob在網路上取得公鑰後，會以Alice的公鑰進行加密，之後將密文寄送給Alice，在傳遞信息的過程中，既使網路存在著監聽，也無法將信息順利解密，唯有Alice收到信息後使用原本產生該公鑰的私鑰，才可以解出明文。第二種則應用在比特幣的交易的數字簽名以及交易驗證交易，比特幣地址的創建過程中會透過secp256k1生成私鑰公鑰對，在創建比特幣交易的過程中，使用該地址的私鑰對該地址未花费的输出（Unspent Transaction Output，UTXO）進行數字簽名，完成數字簽名後會與公鑰以及交易信息一起廣播治比特幣網路的交易緩存持當中，等待礦工的將該筆交易收入至比特幣區塊鏈當中。
			比特幣採用的secp256k1是屬於椭圆曲线密码学中的一個版本，不同的橢圓曲線版本的差異在於不同的初始參數，包括橢圓曲線函數、p值巨大的質數、G點被称为⽣成点的常数点亦稱為基點。至於為什麼選擇ECC而非RSA的主要原因，其一在於ECC在生成密鑰對所需的時間更佳快速，下圖\ref{ECCtime}為Nicholas Jansma於2004年針對ECC與RSA的密鑰對生成時間與數字簽名所需時間的論文\parencite{Performancecomparisonofellipticcurveandrsadigitalsignatures}指出，當ECC產生571bit的密鑰長度，RSA要達到相同的安全性需要生成15360bit，至於生成的時間差距高達471倍。
			
			\begin{figure}[h]
				\centering
				\includegraphics[width = .5\textwidth]{ECCtime.png}
				\caption{ECC與RSA的密鑰對生成時間\parencite{Performancecomparisonofellipticcurveandrsadigitalsignatures}}\label{ECCtime}
			\end{figure}

			除了在於密鑰對生成時間ECC有著比RSA更高效的算法外，在安全性上ECC可以更短的密鑰長度達到與RSA相同的安全強度，L Ducas針對ECC、RSA、BLISS做出了深度的安全性探討\parencite{LatticesignaturesandbimodalGaussians}，\ref{LatticesignaturesandbimodalGaussians}研究指出，同樣達到80bit的安全性級數，RSA 1024需要1024bit，ECDSA 160僅需要160bit，該篇論文除了探討RSA與ECDSA之外，更大的部分在闡述量子計算機對於既有的傳統密碼帶來的抨擊，有機會快速窮舉$2^{256}$的比特幣私鑰，在未來涼己計算機的蓬勃發展擁有2000qbit運算能力的量子計算機可以快速窮舉破解所有的比特幣私鑰。因此發展針對量子計算機設計的數字簽名算法成為密碼學上嶄新的議題，而BLISS則為針對量子計算機所設計的抗量子計算的簽名算法。

			\begin{figure}[h]
				\centering
				\includegraphics[width = 1\textwidth]{LatticesignaturesandbimodalGaussians.png}
				\caption{ＸＸＸ\parencite{LatticesignaturesandbimodalGaussians}}\label{LatticesignaturesandbimodalGaussians}
			\end{figure}

			\subsubsection{SHA-256}
			哈希下數在比特幣系統中，扮演著相當多的角色，包括彼特幣地址生成、比特幣交易哈希指針、比特幣區塊哈希指針、比特幣挖礦算法工作量證明。哈希算有幾大特色，分別為
			\subsubsection{RIPEMD-160}
			\subsubsection{Base58}

		\subsection{比特幣地址生成過程}

			\begin{figure}[h]
				\centering
				\includegraphics[width = .9\textwidth]{address.png}
				\caption{比特幣地址生成過程}\label{address}
			\end{figure}

			\paragraph{生成私鑰}使用亂數產生器產生一個長度在256bit以內的隨機數，而此隨機數即成為該地址的私鑰，在比特幣系統中，可以利用私鑰(Private Key)簽署花費該地址當中的比特幣。
			\paragraph{生成公鑰}該演算法為一個以橢圓曲線演算法為基礎的一個標準，而在不同標準的差異在於初始化的參數，這些參數的訂定皆經過嚴謹的考核及實驗測試。在比特幣系統中該算法扮演著私鑰轉換為公鑰的角色。使得比特幣交易使用私鑰進行簽署之後，還可以使用公鑰校驗該比特幣交易的正確性。
			\paragraph{生成公鑰SHA-256}一種雜湊函數，雜湊函數的特性有許多，包括雪崩效應、不可預測、不可逆、校驗檔案是否完整。在此步驟中是將公鑰帶入SHA-256 函數中，產出長度為256bit的雜湊值。
			\paragraph{生成公鑰SHA-256的RIPEMD-160}亦為雜湊函數的一種，特色符合雜湊函數的特性，與SHA-256不同的是RIPEMD-160產出的長度為160bit。
			\paragraph{校驗碼生成}校驗碼為比特幣地址生成過程中重要的一環，可在支付比特幣的過程中解決因為手誤而將比特幣轉入到不存在(不符合比特幣地址生成規則)地址的可能性。對公鑰SHA-256的RIPEMD-160再做兩次SHA-256，取該哈希值得前32bit的值作為校驗碼
			\paragraph{取得版本號}比特幣在一開始設計的過程中，便定義了不同的地址樣式及功能，在第五個步驟中會加入版本號加以區分不同的地址。
			\paragraph{版本號、公鑰SHA-256的RIPEMD-160和校驗碼合併}版本號、第四個步驟的產物公鑰RIPEMD-160及第五個步驟的校驗碼合併。
			\paragraph{合併的結果以Base58編碼}將第六步驟組合成的結果，利用base 58進行編碼，Base 58為修改自Base 64其最大的不同在於移除了"0"、"O"、"I"、"l"、"+"、"/"的字符，可以降低人工判讀在地址的錯誤率。


		% \subsection{多重簽名（Multi-Signature）}
		% 	\subsubsection{多重簽名地址}
		% 	\subsubsection{Green Address}

	\section{區塊鏈（Blockchain）}
	%區塊頭所有的結構
	自2009年以來，加密數字貨幣比特幣的誕生引發了新的貨幣革命浪潮，基於密碼學，點對點網絡，共識算法和區塊鏈技術，它們被結合成比特幣等數字貨幣。到目前為止，它在九年內發生大量的襲擊和欺詐事件後仍然在積極努力。 比特幣一直是互聯網上最具代表性的數字貨幣。比特幣是區塊鏈技術最重要的應用之一。我們將描述區塊鏈技術的一些細節。

		\subsection{本區塊大小的值 }
		\subsection{區塊頭（Block Header）}
			\paragraph{區塊版本（32 bits）}該欄位存儲比特幣區塊鏈中的區塊版本。
			\paragraph{前區塊的哈希值（256 bits）}記錄前一個塊的哈希值。 根據當前區塊的前一個區塊哈希值進而形成哈希指針，所有塊可以因為哈希指針連接在一起形成比特幣區塊鏈，不僅可以在區塊與區塊間建立虛擬鏈接，還可以使得區塊更難以被篡改。為新區塊不斷疊加在舊的區塊上，舊區塊的哈希值將繼續傳遞到最新的區塊。若區塊上面堆疊更多的區塊，促使的哈希職間接引用越多次，因此較早創建的區塊更難以修改。
			\paragraph{Merkle Root（256 bits）}Merkle Root的生成方法是將當前區塊的所有交易為n個進行排序後，屆時的交易為n個樹葉，將每個樹葉進行一次sha-256取得哈希值得到n個哈希值，再兩兩配對合併進行哈希，得到$2^{-1}$個哈希值後，直到合併到只剩下一個哈希值，最後一個哈希值則為Merkle Root，在區塊鏈中的Merkle Root可用於快速檢查當前區塊中所有存儲事務的正確性。
			\paragraph{難易度（32 bits）}在比特幣網路中難易度參數平均每十五天會有所變動，用以調控比特幣區快的產出頻率，在過去的密碼貨幣的設計中，有著因為沒有動態修改區塊難度，而導致區塊鏈生成速度太快，甚至導致區塊鏈系統崩潰。
			\paragraph{時間戳記（32 bits）}以年、月、日、小時和秒的格式記錄區塊生成時間。
			\paragraph{Nonce（32 bits）}Nonce記錄著礦工在進行挖礦時，必須要不斷的嘗試Nonce參數，直到符合難易度參數，才可以創建一個全新的比特幣區塊。該值為32 bits ，意為著礦工嘗試的組態空間為$2^{32}$個可能性。


	%區塊內容 交易手續費攻擊
		\subsection{Block Data}
			\subsubsection{交易計數器 （4-36 bits）}
			\subsubsection{交易信息}

	\section{工作量證明（Proof of Work）}
	\section{點對點網路（Peer to peer network）}

	去中心化的密碼貨幣系統帶給社會帶給傳統的中心化的金融體系以及政府帶來了很重大的衝擊，中本聰建構了一個不需要中央銀行發行貨幣的貨幣系統，在比特幣的貨幣發行上全靠區塊鏈既定的算法。除了貨幣發行，也將交易紀錄的帳本已明文的方式儲存在去中心化的區塊鏈中，以比特幣為例，現今的完整的比特幣區塊鏈帳本已經高達180GB，這樣保存完整交易資料的計算機稱之為全節點，在比特幣去中心化的網路中，如圖\ref{bitcoinfullnode}所示，截至2018年1月25比特幣網路中全節點數量為10552個\parencite{bitcoinfullnode}，全節點的數量決定了比特幣帳本的可靠度，倘若有著更多的全結點，會使得比特幣網路堅不可摧，更難去修改歷史發生過的交易數據。

	\begin{figure}
		\centering
		\includegraphics[width = .9\textwidth]{bitcoinfullnode.png}
		\caption{Bitcoin Full Node\parencite{bitcoinfullnode}}\label{bitcoinfullnode}
	\end{figure}

	% \section{山寨幣（Altcoin）簡介}

	% 	\subsection{萊特幣（Litecoin）}

	% 	\subsection{狗幣（Dogecoin）}

	% 	\subsection{域名幣（Namecoin）}

	% 	\subsection{以太坊（Etherum）}

% vim:ts=4:sw=4
